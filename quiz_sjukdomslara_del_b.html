<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sjukdomsl√§ra del B ‚Äî Quiz</title>
<style>
  :root{
    --bg:#f6f8ff; --card:#ffffff; --text:#0f172a; --muted:#64748b; --accent:#2563eb;
  }
  .dark{
    --bg:#071029; --card:#081224; --text:#e6eef8; --muted:#9fb3d6; --accent:#3b82f6;
  }
  body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);transition:background .25s,color .25s}
  .container{max-width:980px;margin:28px auto;padding:18px}
  .card{background:var(--card);border-radius:14px;padding:18px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 8px 24px rgba(2,6,23,0.06)}
  h1{margin:0 0 8px 0}
  .chips{display:flex;flex-wrap:wrap;gap:10px}
  .chip{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:999px;border:1px solid var(--muted);background:transparent;color:var(--text);cursor:pointer;font-weight:600}
  .chip.selected{background:linear-gradient(135deg,var(--accent),#60a5fa);color:white;border:0;box-shadow:0 6px 18px rgba(37,99,235,0.18)}
  .qbtn{padding:10px 14px;border-radius:12px;border:1px solid var(--muted);background:transparent;color:var(--text);cursor:pointer;font-weight:700}
  .qbtn.selected{background:linear-gradient(90deg,#34d399,#60a5fa);color:white;border:0}
  button.primary{background:var(--accent);color:white;border:0;padding:10px 18px;border-radius:12px;cursor:pointer;font-weight:700}
  button.answer{display:block;width:100%;text-align:left;padding:12px 14px;margin-top:12px;border-radius:12px;border:0;background:linear-gradient(90deg,#eef2ff,#fff);cursor:pointer;font-weight:600}
  button.correct{background:linear-gradient(90deg,#34d399,#10b981) !important;color:white;border:0}
  button.wrong{background:linear-gradient(90deg,#fb7185,#ef4444) !important;color:white;border:0}
  #themeToggle{position:fixed;right:60px;top:18px;padding:8px;border-radius:10px;border:0;background:var(--card);cursor:pointer;z-index:9999}
  #soundToggleBtn{position:fixed;right:18px;top:18px;padding:8px;border-radius:10px;border:0;background:var(--card);cursor:pointer;z-index:9999}
  #homeBtn{position:fixed;left:18px;top:18px;padding:8px;border-radius:10px;border:0;background:var(--card);cursor:pointer;z-index:9999}
  .score{font-weight:700;margin-top:12px}
  .result-list{margin-top:12px}
  .actions-row{display:flex;gap:10px;margin-top:16px}
  .small{font-size:0.9rem;color:var(--muted)}
  .progress-wrap{height:12px;background:rgba(15,23,42,0.06);border-radius:999px;overflow:hidden;margin-top:10px}
  .progress-bar{height:100%;width:0%;transition:width .35s}
  .confetti{position:fixed;width:10px;height:14px;opacity:0.95;z-index:9999;border-radius:2px}
  .stats-grid{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .stat-card{padding:8px 12px;background:rgba(14,165,233,0.05);border-radius:10px;font-weight:700}
  #historyChart{width:100%;height:80px}
  /* Sm√• estetiska tweaks */
  .title-big{font-family:'Comic Sans MS', 'Segoe UI', Tahoma, sans-serif;font-size:28px}
  .muted-block{color:var(--muted);font-size:0.9rem}
</style>
</head>
<body>
  <button id="themeToggle" title="Ljus/m√∂rk">üåì</button>
  <button id="soundToggleBtn" title="Ljud av/p√•">üîà</button>
  <button id="homeBtn" style="display:none" title="Till huvudmenyn">üè†</button>

  <div class="container">
    <div id="setup" class="card">
      <div class="title-big">Sjukdomsl√§ra del B</div>
      <h1 style="margin-top:6px">QUIZET</h1>
      <div class="muted-block">V√§lj kategorier och antal fr√•gor (10/20/30/40)</div>

      <div style="height:12px"></div>
      <div class="small">Dina b√§sta resultat: <span id="bestScore">-</span></div>
      <div class="stats-grid" id="statsGrid"></div>
      <div style="height:12px"></div>

      <div><strong>Kategorier</strong></div>
      <div class="chips" id="catContainer"></div>

      <h3 style="margin-top:16px">Antal fr√•gor</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="qbtn" data-n="10">10</button>
        <button class="qbtn" data-n="20">20</button>
        <button class="qbtn" data-n="30">30</button>
        <button class="qbtn" data-n="40">40</button>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
        <label style="display:inline-flex;align-items:center;gap:10px"><input id="hintToggle" type="checkbox"> Visa f√∂rklaring efter svar</label>
      </div>

      <div style="margin-top:16px">
        <button id="go" class="primary">Starta quiz</button>
      </div>

      <div style="margin-top:14px">
        <canvas id="historyChart"></canvas>
      </div>

    </div>

    <div id="quiz" class="card" style="display:none;margin-top:18px">
      <div id="progressWrap" class="small">Fr√•ga <span id="curIdx">0</span>/<span id="curTotal">0</span>
        <div class="progress-wrap"><div id="progressBar" class="progress-bar"></div></div>
      </div>
      <div id="quizContent" style="margin-top:12px"></div>
    </div>

    <div id="result" class="card" style="display:none;margin-top:18px"></div>
  </div>

<script>
/* ---------- DEBUG LOG: START ---------- */
console.log('Quiz HTML laddad');
// Debug helper
function dbg(...args){ console.log('[DEBUG]', ...args); }
/* ---------- DEBUG LOG: END   ---------- */

/* ---------------------------
   FR√ÖGEBANK (inb√§ddad)
   --------------------------- */
const bank = {
  "Hematologi":[
    {q:"Vilket prov anv√§nds f√∂r att definiera anemi hos kvinnor?",a:["<120 g/L","<130 g/L","<110 g/L"],correct:0},
    {q:"Vilken brist orsakar megaloblastanemi?",a:["J√§rn","B12 eller folat","Erytropoetin"],correct:1},
    {q:"Vilket symtom √§r typiskt vid hemolys?",a:["Minskad bilirubin","Ikterus","Hypotermi"],correct:1},
    {q:"Vilket v√§rde √§r l√•gt vid j√§rnbristanemi?",a:["Ferritin","Natrium","CRP"],correct:0},
    {q:"Vad √§r trombocytopeni?",a:["F√∂r lite vita blodkroppar","F√∂r lite blodpl√§ttar","F√∂r lite plasma"],correct:1},
    {q:"Vad √∂kar retikulocyter vid?",a:["Hemolys","Virusinfektion","Hypertoni"],correct:0},
    {q:"Vad orsakar sekund√§r anemi?",a:["Inflammation","F√∂r lite salt","F√∂r mycket vatten"],correct:0},
    {q:"Tecken p√• j√§rnbrist?",a:["Glossit","Bradykardi","Panik√•ngest"],correct:0},
    {q:"Vad √§r petechier?",a:["Sm√• bl√∂dningar i huden","Hudsvamp","V√§rmeutslag"],correct:0},
    {q:"Vilken behandling ges ofta vid B12-brist?",a:["Intramuskul√§ra injektioner","Tablettkortison","Insulin"],correct:0},
    {q:"Vad √§r aplastisk anemi?",a:["Brist p√• alla blodcellslinjer","√ñkad Hb","H√∂gt ferritin"],correct:0},
    {q:"Vilken provparameter visar erytrocytstorlek?",a:["MCV","CRP","TIBC"],correct:0},
    {q:"Vad indikerar h√∂gt LD?",a:["Hemolys eller v√§vnadsskada","Hypotyreos","L√•gt blodsocker"],correct:0},
    {q:"Vid misstanke p√• leukemi g√∂rs ofta?",a:["Benm√§rgsprov","Lungfunktionstest","Hudbiopsi"],correct:0},
    {q:"Vad √§r vanlig komplikation vid neutropeni?",a:["Allvarliga infektioner","Hypertoni","Blodpropp"],correct:0},
    {q:"Vilken behandling anv√§nds vid j√§rnbrist?",a:["J√§rntabletter","Kortison","Bisfosfonater"],correct:0},
    {q:"Vad betyder trombocytos?",a:["F√∂r mycket blodpl√§ttar","F√∂r lite vita blodkroppar","L√•gt Hb"],correct:0},
    {q:"Vad m√§ter retikulocyter?",a:["Nya r√∂da blodkroppar","Blodglukos","CRP"],correct:0},
    {q:"Vilket prov f√∂ljer hemolys?",a:["Haptoglobin minskar","Ferritin √∂kar","PSA √∂kar"],correct:0},
    {q:"Vad √§r en vanlig orsak till makrocyt√§r anemi?",a:["B12-brist","J√§rnbrist","Njursvikt"],correct:0}
  ],
  "Onkologi":[
    {q:"Vilken metod anv√§nds f√∂r screening av br√∂stcancer?",a:["CT","Mammografi","MR"],correct:1},
    {q:"Vilket symtom √§r typiskt vid leukemi?",a:["√ñkad muskelmassa","Bl√•m√§rken","√ñkad aptit"],correct:1},
    {q:"Vad betyder metastasering?",a:["Att tum√∂ren krymper","Spridning av cancer","En godartad f√∂r√§ndring"],correct:1},
    {q:"Vilken behandling √§r vanlig vid lymfom?",a:["Antibiotika","Cytostatika","Insulin"],correct:1},
    {q:"Vilket √§r ett alarmsymtom vid cancer?",a:["Tillf√§llig snuva","L√•ngvarig hosta","Feber under 38¬∞C"],correct:1},
    {q:"Vad √§r tum√∂rlyssyndrom?",a:["Snabb tum√∂rnedbrytning","L√•ngsam tillv√§xt","Lokal infektion"],correct:0},
    {q:"Vilken behandling kan p√•verka fertilitet?",a:["Cytostatika","Antibiotika","NSAID"],correct:0},
    {q:"Vilken unders√∂kning anv√§nds f√∂r att p√•visa metastaser?",a:["PET","EKG","Spirometri"],correct:0},
    {q:"Vad inneb√§r palliativ v√•rd?",a:["Botande","Symtomlindrande","F√∂rebyggande"],correct:1},
    {q:"Vilken mark√∂r anv√§nds ofta i prostatacanceruppf√∂ljning?",a:["PSA","CEA","CA-125"],correct:0},
    {q:"Vad √§r neoadjuvant behandling?",a:["Behandling f√∂re operation","Behandling efter 10 √•r","Endast sm√§rtlindring"],correct:0},
    {q:"Vilken biverkan √§r vanlig vid cytostatika?",a:["H√•ravfall","√ñkad bent√§thet","√ñkad aptit"],correct:0},
    {q:"Vad betyder kurativ behandling?",a:["Botande syfte","Palliativt syfte","Endast f√∂rebyggande"],correct:0},
    {q:"Vad √§r viktigaste √•tg√§rden vid misst√§nkt malign tum√∂r?",a:["Biopsi","Vila","Antibiotika direkt"],correct:0},
    {q:"Vilken unders√∂kning anv√§nds f√∂r br√∂sttum√∂rer?",a:["Mammografi","EKG","Lung-CT"],correct:0},
    {q:"Vad √§r m√•let med palliativ kemoterapi?",a:["Symtomlindring och livsf√∂rl√§ngning","Fullst√§ndig bot","√ñka aptit"],correct:0},
    {q:"Vad b√∂r f√∂ljas upp efter cancerbehandling?",a:["Recidiv och biverkningar","Endast blodtryck","Endast vikt"],correct:0},
    {q:"Vilken tum√∂rmark√∂r kan anv√§ndas vid ovarialcancer?",a:["CA-125","PSA","CEA"],correct:0},
    {q:"Vad inneb√§r remiss till cancercentrum?",a:["Specialiserad bed√∂mning","Akut ambulans","Fysioterapi"],correct:0},
    {q:"Vad √§r vanligaste palliativa symtomet?",a:["Sm√§rta","Frossa","Kl√•da"],correct:0}
  ],
  "Reumatiska sjukdomar":[
    {q:"Vilken autoantikropp √§r typisk vid RA?",a:["ACPA","ANA","PSA"],correct:0},
    {q:"Vad √§r ett vanligt symtom vid RA?",a:["Nedsatt syn","Morgonstelhet","Snabb puls"],correct:1},
    {q:"Vilken behandling anv√§nds ofta vid RA?",a:["Metotrexat","Penicillin","Insulin"],correct:0},
    {q:"Vad √§r ett typiskt fynd vid artros?",a:["Ledsvullnad","Nedslitet ledbrosk","Hudutslag"],correct:1},
    {q:"Vilket prov √§r ofta f√∂rh√∂jt vid inflammation?",a:["Albumin","CRP","Kalcium"],correct:1},
    {q:"Vad kan l√•ngvarigt kortison leda till?",a:["Osteoporos","√ñkad muskelmassa","F√∂rb√§ttrad s√∂mn"],correct:0},
    {q:"Vilket tillst√•nd ger uratkristaller i leder?",a:["Gikt","RA","Osteoporos"],correct:0},
    {q:"Vilken √•tg√§rd √§r viktig vid artros?",a:["Fysisk tr√§ning","Total vila","Antibiotika"],correct:0},
    {q:"Vilken sjukdom ger torrhet i √∂gon och mun?",a:["Sj√∂grens syndrom","Gikt","KML"],correct:0},
    {q:"Vilken unders√∂kning visar ledbrosk b√§st?",a:["MR","EKG","R√∂ntgen av handen"],correct:0},
    {q:"Vad √§r spondylartrit?",a:["Inflammation i ryggraden","Lunginflammation","H√∂ftluxation"],correct:0},
    {q:"Vilket l√§kemedel √§r en TNF-h√§mmare?",a:["Infliximab","Paracetamol","Ibuprofen"],correct:0},
    {q:"Vilken provsvar ses ofta vid autoimmunitet?",a:["ANA positiv","L√•gt Hb","H√∂gt TSH"],correct:0},
    {q:"Vad √§r systemisk lupus erythematosus?",a:["En autoimmun multisystemsjukdom","Enbart hud√•komma","Endast ledv√§rk"],correct:0},
    {q:"Vilken unders√∂kning kan visa inflammation i led?",a:["Ultraljud","EKG","R√∂ntgen av br√∂stkorg"],correct:0},
    {q:"Vad √§r handl√§ggning vid akut giktanfall?",a:["NSAID och vila","Antibiotika","Kortison dagligen"],correct:0},
    {q:"Vilket r√•d ges f√∂r l√•ngsiktig RA-handling?",a:["Tidigt DMARD-behandling","Undvik tr√§ning","√ñka sockerintag"],correct:0},
    {q:"Vad √§r typiskt vid polymyalgia rheumatica?",a:["Morgonstelhet och muskelsm√§rta","Hudutslag","Feber √∂ver 40¬∞C"],correct:0},
    {q:"Vilket symtom ses vid reaktiv artrit?",a:["Ledproblem efter infektion","Pl√∂tslig blindhet","H√∂rselneds√§ttning"],correct:0},
    {q:"Vad √§r ett viktigt m√•l vid reumatologisk behandling?",a:["Remission eller l√•g sjukdomsaktivitet","Endast sm√§rtlindring","√ñkad medicinering alltid"],correct:0}
  ],
  "Osteoporos":[
    {q:"Vad m√§ter en DEXA-unders√∂kning?",a:["Bent√§thet","Lungfunktion","Hj√§rtstorlek"],correct:0},
    {q:"Vad √∂kar risken f√∂r osteoporos?",a:["Fysisk aktivitet","R√∂kning","H√∂gt blodtryck"],correct:1},
    {q:"Vilken vitamin √§r viktig f√∂r benh√§lsa?",a:["D-vitamin","C-vitamin","B1"],correct:0},
    {q:"Vad √§r en typisk komplikation vid osteoporos?",a:["Bensk√∂rhetsfraktur","Muskelbristning","Njursvikt"],correct:0},
    {q:"Vilket hormon √§r viktigt f√∂r skelettet?",a:["√ñstrogen","Adrenalin","Insulin"],correct:0},
    {q:"Vilken l√§kemedelsgrupp minskar benresorption?",a:["Bisfosfonater","NSAID","Antibiotika"],correct:0},
    {q:"Vad √§r viktigt f√∂r fallprevention?",a:["Tr√§ning och hemmilj√∂bed√∂mning","√ñkad s√§ngtid","Undvika v√§tska"],correct:0},
    {q:"Vilken fraktur √§r vanlig vid osteoporos?",a:["H√∂ftfraktur","Handfraktur","Skulderfraktur"],correct:0},
    {q:"Vad kontrolleras vid osteoporosutredning?",a:["D-vitamin","PSA","TSH"],correct:0},
    {q:"Vilken livsstilsfaktor minskar bent√§thet?",a:["R√∂kning","Styrketr√§ning","Vitaminintag"],correct:0},
    {q:"Vad √§r sekund√§r osteoporos?",a:["Bensk√∂rhet pga annan sjukdom eller l√§kemedel","√Öldersrelaterad bensk√∂rhet","Barns sjukdom"],correct:0},
    {q:"Vilken unders√∂kning √§r f√∂rsta steg vid frakturmisstanke?",a:["R√∂ntgen","DEXA","Blodprov"],correct:0},
    {q:"Vilken kostr√•dgivning ges vid osteoporos?",a:["Kalciumrik kost och D-vitamin","Undvik protein","Endast fettfri kost"],correct:0},
    {q:"Vad √§r konsekvensen av h√∂gt fallriskindex?",a:["√ñkad frakturrisk","Minskad depression","√ñkad aptit"],correct:0},
    {q:"Vilken √•tg√§rd minskar vertebrala frakturer?",a:["Bisfosfonater","Kortison","Antibiotika"],correct:0},
    {q:"N√§r rekommenderas osteoporosutredning?",a:["Efter l√•genergifraktur","Vid ton√•rssm√§rta","Varje √•r fr√•n 20"],correct:0},
    {q:"Vad √§r FRAX?",a:["Riskverktyg f√∂r fraktur","Ett l√§kemedel","En kirurgisk metod"],correct:0},
    {q:"Vilken grupp har h√∂gst risk f√∂r osteoporos?",a:["Postmenopausala kvinnor","Barn","Yrkesidrottare"],correct:0},
    {q:"Vad √§r en vanlig profylax efter h√∂ftfraktur?",a:["Fallprevention och styrketr√§ning","L√•ng s√§ngvila","√ñkad saltintag"],correct:0},
    {q:"Vilken effekt har r√∂kstopp p√• benh√§lsa?",a:["Minskar frakturrisken √∂ver tid","√ñkar frakturer direkt","Ingen effekt"],correct:0}
  ],
  "Ortopedi":[
    {q:"Vilken fraktur √§r vanlig hos √§ldre vid fall?",a:["H√∂ftfraktur","Axelfraktur","N√§sfraktur"],correct:0},
    {q:"Vad √§r f√∂rsta √•tg√§rd vid misst√§nkt fraktur?",a:["Belasta benet","Immobilisera","Massage"],correct:1},
    {q:"Vilket symtom tyder p√• compartment syndrome?",a:["√ñkad aptit","Sv√•r sm√§rta","Feber"],correct:1},
    {q:"Vad anv√§nds ofta f√∂r att diagnosticera en fraktur?",a:["MR","R√∂ntgen","PET"],correct:1},
    {q:"Vad √§r luxation?",a:["Bl√∂dning","Ur led","Infektion"],correct:1},
    {q:"Vad √§r viktigt postoperativt efter h√∂ftfraktur?",a:["Tidig mobilisering","L√•ng s√§ngvila","Ingen mat"],correct:0},
    {q:"Vilken behandling anv√§nds f√∂r instabila tibiafrakturer?",a:["Intramedull√§r spik","Ortotik","Kortison"],correct:0},
    {q:"Vad √§r extern fixation?",a:["Yttre stag f√∂r stabilisering","En typ av sm√§rtlindring","Ett l√§kemedel"],correct:0},
    {q:"Vilken komplikation kan f√∂lja axill√§r lymfk√∂rtelkirurgi?",a:["Lymf√∂dem","Diabetes","Urinv√§gsinfektion"],correct:0},
    {q:"Vad indikerar kortat och ut√•troterat ben efter trauma?",a:["Dislocerad cervikal h√∂ftfraktur","Distal radiusfraktur","Kn√§luxation"],correct:0},
    {q:"Vad √§r viktigast f√∂r att f√∂rebygga DVT efter operation?",a:["Trombosprofylax och mobilisering","Total vila","Endast kompression"],correct:0},
    {q:"Vad √§r en vanlig orsak till kn√§sm√§rta?",a:["Artros","Hj√§rtsvikt","Astma"],correct:0},
    {q:"Vad √§r en femurfraktur ofta associerad med?",a:["H√∂ftproblematik","Halsbr√§nna","H√∂gt blodtryck"],correct:0},
    {q:"Vilken √•tg√§rd vid √∂ppen fraktur?",a:["Operation och antibiotika","Vila hemma","Endast sm√§rtstillning"],correct:0},
    {q:"Vad √§r skillnaden mellan spricka och komplett fraktur?",a:["Spricka ej genom benet, komplett genom hela benet","Spricka √§r allvarligare","Spricka l√§ker aldrig"],correct:0},
    {q:"Vad √§r viktigt efter ligamentkirurgi?",a:["Rehab och l√•ngsam belastning","Omedelbar full belastning","Undvik fysioterapi"],correct:0},
    {q:"Vilket test kan anv√§ndas f√∂r ACL-skada?",a:["Lachman-test","Spirometri","EKG"],correct:0},
    {q:"Vad √§r en proximal humerusfraktur?",a:["Fraktur i √∂verarmen n√§ra axeln","Fraktur i underbenet","Fraktur i skallbenet"],correct:0},
    {q:"Vad √§r m√•let med ortopedisk akut behandling?",a:["Stabilisering och sm√§rtlindring","Fullst√§ndig bot i 1 dag","Endast observation"],correct:0}
  ],
  "Geriatrik/kognitiva sjukdomar":[
    {q:"Vad inneb√§r delirium?",a:["Kronisk minnesf√∂rlust","Akut f√∂rvirring","Synhallucinationer"],correct:1},
    {q:"Vad √§r ett tidigt symtom p√• demens?",a:["Ryggsm√§rta","Minnesst√∂rning","Hosta"],correct:1},
    {q:"Vilken √§r en riskfaktor f√∂r delirium?",a:["Stabil elektrolytbalans","Infektion","H√∂g kondition"],correct:1},
    {q:"Vad √§r BPSD?",a:["Beteendem√§ssiga och psykiska symtom vid demens","Blodtrycksfall","Balansp√•verkan"],correct:0},
    {q:"Vilket √§r vanligt vid Alzheimers?",a:["Personlighetsf√∂r√§ndringar","St√∂rd leverfunktion","√ñkad muskelmassa"],correct:0},
    {q:"Vad √§r multisjuklighet?",a:["Flera samtidiga kroniska sjukdomar","Endast en sjukdom","Endast psykisk sjukdom"],correct:0},
    {q:"Vad √§r viktigt vid v√•rd av √§ldre efter h√∂ftfraktur?",a:["Snabb operation och rehab","L√•ng s√§ngvila","Bortse fr√•n nutrition"],correct:0},
    {q:"Vilken √•tg√§rd f√∂rebygger fall hos √§ldre?",a:["Styrketr√§ning och hemmilj√∂anpassning","√ñka l√§kemedel","Minska v√§tska"],correct:0},
    {q:"Vilket tillst√•nd kan vara reversibelt hos √§ldre?",a:["Delirium","Alzheimers","Parkinsons"],correct:0},
    {q:"Vad √§r viktigast i nutrition f√∂r √§ldre?",a:["Energi- och proteinrik kost","V√§ldigt l√•g kaloriintag","Endast flytande"],correct:0},
    {q:"Vilken √•tg√§rd minskar risken f√∂r trycks√•r?",a:["Tidiga v√§ndningar och hudinspektion","Full s√§ngvila","√ñkad socker"],correct:0},
    {q:"Vad √§r polyfarmaci?",a:["M√•nga samtidiga l√§kemedel","Brist p√• l√§kemedel","Endast naturl√§kemedel"],correct:0},
    {q:"Vad √§r normal √•ldrande vs sjukdom?",a:["L√•ngsam kognitiv nedg√•ng √§r inte alltid sjukdom","Allt minnesbortfall √§r sjukdom","Alla √§ldre f√•r demens"],correct:0},
    {q:"Vad √§r viktigt vid utskrivning av √§ldre?",a:["Planering av rehab och hj√§lpinsatser","Ingen uppf√∂ljning","Avvakta 6 m√•nader"],correct:0},
    {q:"Vilket instrument kan screena kognitiv funktion?",a:["MMSE eller MoCA","EKG","Spirometri"],correct:0},
    {q:"Vad √§r en vanlig orsak till fall hos √§ldre?",a:["L√§kemedelsbiverkan","Ungdomlig hyperaktivitet","√ñvertr√§ning"],correct:0},
    {q:"Vad √§r viktigt f√∂r social h√§lsa f√∂r √§ldre?",a:["Kontakt och aktiviteter","Isolering","Endast vila"],correct:0},
    {q:"Vilken dietrisk √§r vanlig hos √§ldre?",a:["Undern√§ring","√ñver√§tning","F√∂rmycket protein"],correct:0},
    {q:"Vilken √•tg√§rd hj√§lper √•terh√§mtning efter infektion hos √§ldre?",a:["Tidigt mobilisering och nutrition","S√§ngl√§ge utan mat","Undvik v√§tska"],correct:0}
  ],
  "Neurologiska sjukdomar":[
    {q:"Vad √§r ett typiskt symtom vid MS?",a:["Demyeliniserande skador","F√∂rlamning av hj√§rnnerver","√ñkad bent√§thet"],correct:0},
    {q:"Vilket symtom √§r vanligt vid Parkinsons sjukdom?",a:["Tremor","H√•ravfall","Sv√§ljsv√•righeter"],correct:0},
    {q:"Vad orsakar epilepsi?",a:["Okontrollerad elektrisk aktivitet i hj√§rnan","F√∂r lite syre","Vitaminbrist"],correct:0},
    {q:"Vilket symtom √§r vanligt vid ALS?",a:["Muskelf√∂rtvining","Feber","Svullna lymfk√∂rtlar"],correct:0},
    {q:"Vad √§r aura vid migr√§n?",a:["Feber","Synst√∂rningar","Illam√•ende"],correct:1},
    {q:"Vilken unders√∂kning visar fokala lesioner?",a:["CT/MR","EKG","Spirometri"],correct:0},
    {q:"Vad √§r postkommotionellt syndrom?",a:["Symtom efter skallskada","Lungsjukdom","Njursjukdom"],correct:0},
    {q:"Vad √§r viktigt vid epilepsi?",a:["Minska anfall via antiepileptika","√ñka anfall","√ñka alkoholintag"],correct:0},
    {q:"Vilken sjukdom ger ofta vilotremor?",a:["Parkinsons sjukdom","ALS","MS"],correct:0},
    {q:"Vad √§r viktigt att kontrollera vid huvudv√§rk utv√§rdering?",a:["Fokala neurologiska bortfall","Hudfynd","Blodglukos bara"],correct:0},
    {q:"Vad √§r Guillain-Barr√© syndrom?",a:["Akut inflammatorisk polyneuropati","Kronisk huvudv√§rk","Njursjukdom"],correct:0},
    {q:"Vad √§r en generaliserad anfallstyp?",a:["Tonic-clonic","Hemi-seizure","Lokal rodnad"],correct:0},
    {q:"Vilket tillst√•nd kan ge pl√∂tslig ensidig paralys?",a:["Stroke","Astma","Hypotyreos"],correct:0},
    {q:"Vad √§r farmakologisk behandling vid Parkinsons?",a:["Levodopa","Insulin","Antibiotika"],correct:0},
    {q:"Vad st√•r EEG f√∂r?",a:["Elektroencefalogram","Ekokardiogram","Energi EKG"],correct:0},
    {q:"Vad √§r differentiellt vid akut huvudv√§rk?",a:["Subarachnoidalbl√∂dning","Lungemboli","Hj√§rtinfarkt"],correct:0},
    {q:"Vad √§r karakt√§ristiskt f√∂r perifer neuropati?",a:["Distal k√§nselneds√§ttning","Enbart minnesproblem","Endast yrsel"],correct:0},
    {q:"Vad √§r viktig akut √•tg√§rd vid status epilepticus?",a:["Snabb benzodiazepinbehandling","V√§nta","Ge NSAID"],correct:0},
    {q:"Vad √§r viktigt vid rehabilitering efter stroke?",a:["Tidiga mobiliserings- och logopedinsatser","Endast vila","Endast psykolog"],correct:0},
    {q:"Vad kan orsaka polyneuropati?",a:["Diabetes","KOL","H√∂gt blodtryck"],correct:0}
  ],
  "Cerebrovaskul√§ra sjukdomar":[
    {q:"Vad betyder TIA?",a:["Transitorisk ischemisk attack","Total hj√§rninfarkt","Tryck√∂kning i hj√§rnstammen"],correct:0},
    {q:"Vilket symtom √§r typiskt vid stroke?",a:["Ensidig svaghet","Snuva","√ñkad aptit"],correct:0},
    {q:"Vilken unders√∂kning g√∂rs akut vid misst√§nkt stroke?",a:["R√∂ntgen thorax","CT hj√§rna","MR kn√§"],correct:1},
    {q:"Vad √§r FAST-testet till f√∂r?",a:["Identifiera stroke","M√§ta blodtryck","Bed√∂ma lungfunktion"],correct:0},
    {q:"Vad √§r en riskfaktor f√∂r stroke?",a:["Hypertoni","L√•gt blodtryck","H√∂gt insulin"],correct:0},
    {q:"Vad √§r trombolys?",a:["Blodproppsuppl√∂sande behandling","Antibiotikabehandling","Sm√§rtstillande"],correct:0},
    {q:"Vad inneb√§r hemipares?",a:["Halvsidig svaghet","Halsont","H√∂rselneds√§ttning"],correct:0},
    {q:"Varf√∂r g√∂rs sv√§ljbed√∂mning efter stroke?",a:["F√∂r att f√∂rebygga aspiration","F√∂r att m√§ta aptit","F√∂r att √∂ka saliv"],correct:0},
    {q:"Vad √§r viktigt f√∂r sekund√§rprevention efter stroke?",a:["Blodtryckskontroll","Isolering","√ñkad alkohol"],correct:0},
    {q:"Vad inneb√§r reperfusion vid ischemisk stroke?",a:["√Öterst√§llande av blodfl√∂de","√ñkad inflammation","Syrebrist"],correct:0},
    {q:"Vad √§r penumbra vid stroke?",a:["Omr√•de med potentiellt r√§ddbar v√§vnad","Ett l√§kemedel","En kirurgisk teknik"],correct:0},
    {q:"Vilken tid √§r central f√∂r trombolysbeslut?",a:["Tidsf√∂nster inom 4.5 timmar","12 timmar","48 timmar"],correct:0},
    {q:"Vad m√§ter NIHSS?",a:["Stroke-sv√•righetsgrad","Blodtryck","Blodsocker"],correct:0},
    {q:"Vad √§r en komplikation efter stor hemisf√§rinfarkt?",a:["Herniation/√∂kat ICP","Njursvikt","Lungemboli"],correct:0},
    {q:"Vad √§r viktig akut √•tg√§rd vid misst√§nkt subarachnoidalbl√∂dning?",a:["CT utan kontrast","V√§nta","Ge NSAID"],correct:0},
    {q:"Vad √§r indikationen f√∂r mekanisk trombektomi?",a:["St√∂rre proximala k√§rlockulationer","Alla TIA","Endast sm√•bl√∂dningar"],correct:0},
    {q:"Vad inneb√§r antikoagulation efter stroke vid f√∂rmaksflimmer?",a:["Minskar embolirisk","√ñkar infektion","Ingen effekt"],correct:0},
    {q:"Vad √§r viktigt i post-stroke omv√•rdnad f√∂r att minska pneumoni?",a:["Tidig sv√§ljbed√∂mning och mobilisering","√ñkad s√∂mn","Minskad nutrition"],correct:0},
    {q:"Vilken bildmodalitet kan visa bl√∂dning tidigt?",a:["CT utan kontrast","EKG","DEXA"],correct:0},
    {q:"Vad √§r recurrensrisk efter TIA?",a:["F√∂rh√∂jd, speciellt f√∂rsta dagarna","Noll","Endast efter 1 √•r"],correct:0}
  ]
};

/* -------------------------
   UI + Funktioner
   ------------------------- */
dbg('Bygger UI...');
const catContainer = document.getElementById('catContainer');
const icons = {
  'Hematologi':'ü©∏',
  'Onkologi':'üéóÔ∏è',
  'Reumatiska sjukdomar':'üíä',
  'Osteoporos':'ü¶¥',
  'Ortopedi':'üè•',
  'Geriatrik/kognitiva sjukdomar':'üë¥',
  'Neurologiska sjukdomar':'üß†',
  'Cerebrovaskul√§ra sjukdomar':'ü´Ä'
};

// bygg kategoriknappar
Object.keys(bank).forEach(cat=>{
  const btn = document.createElement('button');
  btn.className = 'chip';
  btn.innerHTML = (icons[cat] || 'üìö') + ' ' + cat;
  btn.addEventListener('click', ()=> {
    btn.classList.toggle('selected');
    dbg('Kategori togglad', cat, 'selected=', btn.classList.contains('selected'));
  });
  catContainer.appendChild(btn);
});

const bestDisplay = document.getElementById('bestScore');
const statsGrid = document.getElementById('statsGrid');
const historyCanvas = document.getElementById('historyChart');

// robust localStorage-parser
function safeParseLS(key, fallback){
  try{
    const v = localStorage.getItem(key);
    return v ? JSON.parse(v) : fallback;
  } catch(e){
    console.warn('localStorage parse misslyckades f√∂r', key, e);
    return fallback;
  }
}

function loadStats(){
  dbg('Laddar statistik...');
  const history = safeParseLS('quiz_history', []);
  const last10 = history.slice(-10).reverse();
  const avg = last10.length ? Math.round(last10.reduce((s,r)=>s+r.pct,0)/last10.length) : '-';
  const best = history.length ? Math.max(...history.map(h=>h.pct)) : '-';
  bestDisplay.textContent = best==='-'? 'Inget √§n' : best + '%';
  const catStats = safeParseLS('quiz_cat_stats', {});
  let hardest='-'; let easiest='-';
  if(Object.keys(catStats).length){
    const arr = Object.entries(catStats).map(([k,v])=>({cat:k,pct: Math.round((v.correct/v.attempts)*100)}));
    arr.sort((a,b)=>a.pct-b.pct);
    hardest = arr[0].cat; easiest = arr[arr.length-1].cat;
  }
  statsGrid.innerHTML = `<div class='stat-card'>Senaste: ${last10.length} runs</div><div class='stat-card'>Medel: ${avg}%</div><div class='stat-card'>B√§sta: ${best==='-'?'-':best + '%'}</div><div class='stat-card'>Sv√•raste: ${hardest}</div><div class='stat-card'>L√§ttaste: ${easiest}</div>`;
  drawHistoryChart(last10.map(h=>h.pct));
}

function drawHistoryChart(data){
  const c = historyCanvas; const ctx = c.getContext('2d');
  const dpr = window.devicePixelRatio || 1; c.width = c.clientWidth * dpr; c.height = c.clientHeight * dpr; ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,c.clientWidth,c.clientHeight);
  if(!data.length) { ctx.fillStyle = '#cbd5e1'; ctx.font='14px Arial'; ctx.fillText('Ingen historik √§n',10,30); return; }
  const w = c.clientWidth; const h = c.clientHeight; const pad=8; const step = (w-2*pad)/(data.length-1||1);
  const max = Math.max(100, ...data); const min = 0;
  ctx.beginPath(); ctx.moveTo(pad,h-pad - (data[0]-min)/(max-min)*(h-2*pad));
  data.forEach((v,i)=>{ const x=pad+i*step; const y=h-pad - (v-min)/(max-min)*(h-2*pad); ctx.lineTo(x,y); });
  ctx.lineTo(w-pad,h-pad); ctx.lineTo(pad,h-pad); ctx.closePath(); ctx.fillStyle='rgba(96,165,250,0.15)'; ctx.fill();
  ctx.beginPath(); ctx.moveTo(pad,h-pad - (data[0]-min)/(max-min)*(h-2*pad)); ctx.strokeStyle='#2563eb'; ctx.lineWidth=2;
  data.forEach((v,i)=>{ const x=pad+i*step; const y=h-pad - (v-min)/(max-min)*(h-2*pad); ctx.lineTo(x,y); }); ctx.stroke();
  data.forEach((v,i)=>{ const x=pad+i*step; const y=h-pad - (v-min)/(max-min)*(h-2*pad); ctx.fillStyle='#2563eb'; ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill(); });
}
loadStats();

/* antal-knappar: s√§ker bindning */
let totalQuestions = 10;
document.querySelectorAll('.qbtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.qbtn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    totalQuestions = parseInt(btn.dataset.n);
    dbg('Antal fr√•gor satt:', totalQuestions);
  });
});
// Markera 10 som default
const defaultQBtn = document.querySelector('.qbtn[data-n="10"]');
if (defaultQBtn) defaultQBtn.classList.add('selected');

/* tema & ljud & home */
const themeToggle = document.getElementById('themeToggle');
const homeBtn = document.getElementById('homeBtn');
themeToggle.addEventListener('click', ()=> { document.body.classList.toggle('dark'); dbg('Tema togglat. dark=', document.body.classList.contains('dark')); });
homeBtn.addEventListener('click', ()=> goHome());

let audioEnabled = false;
const soundBtn = document.getElementById('soundToggleBtn');
soundBtn.addEventListener('click', ()=>{ audioEnabled = !audioEnabled; soundBtn.textContent = audioEnabled ? 'üîä' : 'üîà'; dbg('Ljud:', audioEnabled); if(audioEnabled && audioCtx && audioCtx.state==='suspended') audioCtx.resume(); });

const hintToggle = document.getElementById('hintToggle');

/* WebAudio */
const AudioCtxClass = window.AudioContext || window.webkitAudioContext;
const audioCtx = AudioCtxClass ? new AudioCtxClass() : null;
function playTone(freq, duration, volume=0.06){
  if(!audioEnabled || !audioCtx) return;
  const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
  o.type='sine'; o.frequency.value = freq; g.gain.value = volume;
  o.connect(g); g.connect(audioCtx.destination); o.start();
  setTimeout(()=>{ try{ o.stop(); }catch(e){} }, duration);
}

/* Quiz state och funktioner */
let quizList=[]; let answers=[]; let idx=0; let lastQuizList=null; let currentSelectedCats=[];
function shuffle(arr){ return arr.map(v=>({v,sort:Math.random()})).sort((a,b)=>a.sort-b.sort).map(x=>x.v); }

function startQuiz(){
  dbg('StartQuiz anropad');
  currentSelectedCats = [...catContainer.querySelectorAll('.chip.selected')].map(b=>b.textContent.replace(/^\S+\s/,'' ).trim());
  dbg('Valda kategorier:', currentSelectedCats);
  if(!currentSelectedCats.length){ alert('V√§lj minst en kategori'); return; }
  let pool=[];
  currentSelectedCats.forEach(c=> pool = pool.concat(bank[c].map(q=>({...q,category:c}))));
  if(pool.length >= totalQuestions){ quizList = shuffle(pool).slice(0,totalQuestions).map(q=>({...q})); }
  else { quizList = []; for(let i=0;i<totalQuestions;i++) quizList.push(pool[Math.floor(Math.random()*pool.length)]); }
  dbg('Quiz-listans l√§ngd:', quizList.length);
  lastQuizList = quizList.map(q=>({...q})); answers=[]; idx=0;
  document.getElementById('setup').style.display='none';
  document.getElementById('result').style.display='none';
  document.getElementById('quiz').style.display='block';
  homeBtn.style.display = 'inline-block';
  updateProgress();
  showQuestion();
}
document.getElementById('go').addEventListener('click', ()=> { dbg('Start-knapp tryckt'); startQuiz(); });

function categoryColor(cat){
  const map = {
    'Hematologi':'#ef4444','Onkologi':'#9f7aea','Reumatiska sjukdomar':'#f59e0b',
    'Osteoporos':'#60a5fa','Ortopedi':'#10b981','Geriatrik/kognitiva sjukdomar':'#f97316',
    'Neurologiska sjukdomar':'#6366f1','Cerebrovaskul√§ra sjukdomar':'#ef6aa3'
  };
  return map[cat]||'#60a5fa';
}

function updateProgress(){
  document.getElementById('curIdx').textContent = Math.min(idx+1, quizList.length);
  document.getElementById('curTotal').textContent = quizList.length;
  const pct = quizList.length ? Math.round((idx/quizList.length)*100) : 0;
  const bar = document.getElementById('progressBar');
  if(currentSelectedCats.length===1){
    const color = categoryColor(currentSelectedCats[0]);
    bar.style.background = `linear-gradient(90deg, ${color}, #ffffff44)`;
    bar.style.width = pct + '%';
  } else if(currentSelectedCats.length>1){
    const colors = currentSelectedCats.slice(0,4).map(c=>categoryColor(c));
    bar.style.background = `linear-gradient(90deg, ${colors.join(',')})`;
    bar.style.width = pct + '%';
  } else {
    bar.style.background = '';
    bar.style.width = pct + '%';
  }
}

function showQuestion(){
  updateProgress();
  const q = quizList[idx];
  if(!q){ dbg('Ingen fr√•ga funnen vid idx', idx); return; }
  const quizContent = document.getElementById('quizContent');
  quizContent.innerHTML = `<h3>Fr√•ga ${idx+1}/${quizList.length}</h3><p><strong>${q.category}</strong><br>${q.q}</p>`;
  const opts = shuffle(q.a.map((t,i)=>({t,i})));
  opts.forEach(opt=>{
    const b = document.createElement('button'); 
    b.className='answer'; 
    b.textContent = opt.t;
    b.setAttribute('tabindex','0');
    b.setAttribute('role','button');
    b.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        b.click();
      }
    });
    b.addEventListener('click', ()=>{
      dbg('Svar klickat', opt.t, 'index', opt.i);
      // disable all
      [...quizContent.querySelectorAll('button.answer')].forEach(btn=>btn.disabled=true);
      // color chosen
      if(opt.i === q.correct){ b.classList.add('correct'); playTone(880,120,0.06); }
      else { b.classList.add('wrong'); playTone(220,200,0.08); }
      answers.push({q:q.q,category:q.category,correct:q.correct,given:opt.i,options:q.a});
      // show explanation if enabled
      if(hintToggle.checked){
        const hint = document.createElement('div'); hint.className='small'; hint.style.marginTop='8px';
        hint.textContent = 'F√∂rklaring: ' + (q.expl || 'Ingen f√∂rklaring tillagd.');
        quizContent.appendChild(hint);
      }
      setTimeout(()=>{ idx++; if(idx<quizList.length){ showQuestion(); updateProgress(); } else showResult(); },700);
    });
    quizContent.appendChild(b);
  });
}

function confettiCorners(){
  const pieces = 90;
  for(let i=0;i<pieces;i++){
    const d = document.createElement('div'); d.className='confetti';
    d.style.width = (6+Math.random()*10)+'px'; d.style.height = (8+Math.random()*12)+'px';
    d.style.background = `hsl(${Math.random()*360} 90% 60%)`;
    const side = i%2===0 ? 'left' : 'right';
    d.style[side] = (10 + Math.random()*60) + 'px';
    d.style.bottom = '-30px';
    document.body.appendChild(d);
    const dx = (Math.random()*window.innerWidth*0.45) * (side==='left'?1:-1);
    const dy = -(window.innerHeight*0.9 + Math.random()*200);
    const rotate = Math.random()*720;
    d.animate([
      { transform: `translate(0,0) rotate(0deg)`, opacity:1 },
      { transform: `translate(${dx}px, ${dy}px) rotate(${rotate}deg)`, opacity:0 }
    ], { duration: 2400 + Math.random()*1200, easing: 'cubic-bezier(.2,.8,.2,1)' });
    setTimeout(()=>d.remove(), 3800);
  }
}

function showResult(){
  dbg('Visa resultat...');
  document.getElementById('quiz').style.display='none';
  const r = document.getElementById('result'); r.style.display='block';
  const score = answers.filter(a=>a.given===a.correct).length;
  r.innerHTML = `<h2>Resultat: ${score}/${answers.length}</h2>`;
  const pct = Math.round(score/answers.length*100);
  let msg='';
  if(pct>70){ confettiCorners(); msg='Grattis, du kommer f√∂rmodligen klara tentan!'; }
  else if(pct>=60 && pct<=69){ msg='Oj vad n√§ra, p√• en bra dag klarar du nog tentan'; }
  else if(pct>=50 && pct<=59){ msg='Ajd√•, men √∂ver h√§lften √§r √§nd√• bra!'; }
  else if(pct>=30 && pct<=49){ msg='Hmm, du f√•r nog tr√§na lite mer. Heja heja!'; }
  else { msg='Inte ditt b√§sta resultat, men jag vet att du kan b√§ttre!'; }
  const m = document.createElement('div'); m.className='score'; m.textContent=`${pct}% ‚Äî ${msg}`; r.appendChild(m);

  // save history
  const history = safeParseLS('quiz_history', []);
  history.push({pct,score,total:answers.length,date:new Date().toISOString()});
  localStorage.setItem('quiz_history', JSON.stringify(history.slice(-50)));

  // per-category stats
  const catStats = safeParseLS('quiz_cat_stats', {});
  answers.forEach(a=>{
    catStats[a.category] = catStats[a.category] || {attempts:0,correct:0};
    catStats[a.category].attempts += 1;
    if(a.given === a.correct) catStats[a.category].correct += 1;
  });
  localStorage.setItem('quiz_cat_stats', JSON.stringify(catStats));

  // update best
  const prevBest = parseInt(localStorage.getItem('quiz_best_pct')||'0',10);
  if(pct > prevBest){ localStorage.setItem('quiz_best_pct', pct); }
  loadStats();

  // results list (only wrong answers)
  const list = document.createElement('div'); list.className='result-list';
  answers.forEach(a=>{ if(a.given!==a.correct){
    const d=document.createElement('div'); d.style.marginTop='10px';
    d.innerHTML = `<strong>[${a.category}]</strong> ${a.q}<br><span style='color:#ef4444'>Ditt svar: ${a.options[a.given]}</span><br><span style='color:#16a34a'>R√§tt svar: ${a.options[a.correct]}</span>`;
    list.appendChild(d);
  }});
  r.appendChild(list);

  const actions = document.createElement('div'); actions.className='actions-row';
  const newBtn = document.createElement('button'); newBtn.textContent='Nytt quiz'; newBtn.className='primary';
  newBtn.addEventListener('click', ()=> startRandomFromCurrent());
  const sameBtn = document.createElement('button'); sameBtn.textContent='Samma quiz'; sameBtn.className='primary';
  sameBtn.addEventListener('click', ()=>{ 
    if(!lastQuizList) return startQuiz(); 
    quizList = shuffle(lastQuizList.map(q=>({...q}))); 
    answers = []; idx = 0; 
    r.style.display='none'; 
    document.getElementById('quiz').style.display='block'; 
    updateProgress(); 
    showQuestion(); 
  });
  actions.appendChild(newBtn); actions.appendChild(sameBtn);
  r.appendChild(actions);
}

function startRandomFromCurrent(){
  dbg('StartRandomFromCurrent');
  if(!currentSelectedCats || !currentSelectedCats.length) return location.reload();
  let pool = [];
  currentSelectedCats.forEach(c=> pool = pool.concat(bank[c].map(q=>({...q,category:c}))));
  if(pool.length >= totalQuestions){
    quizList = shuffle(pool).slice(0,totalQuestions).map(q=>({...q}));
  } else {
    quizList = [];
    for(let i=0;i<totalQuestions;i++) quizList.push(pool[Math.floor(Math.random()*pool.length)]);
  }
  lastQuizList = quizList.map(q=>({...q}));
  answers = [];
  idx = 0;
  document.getElementById('result').style.display='none';
  document.getElementById('quiz').style.display='block';
  updateProgress();
  showQuestion();
}

function goHome(){
  dbg('G√• hem till startmenyn');
  document.getElementById('setup').style.display='block';
  document.getElementById('quiz').style.display='none';
  document.getElementById('result').style.display='none';
  homeBtn.style.display='none';
}

/* Init */
window.addEventListener('load', ()=>{
  dbg('F√§rdig init, visa start');
  document.getElementById('setup').style.display='block';
  document.getElementById('quiz').style.display='none';
  document.getElementById('result').style.display='none';
  loadStats();
});

// Utility: spara hela sidan som en HTML-fil fr√•n konsolen
window.saveQuizToFile = function(filename = 'quiz.html'){
  try{
    const doc = `<!doctype html>\n${document.documentElement.outerHTML}`;
    const blob = new Blob([doc], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=> URL.revokeObjectURL(url), 1000);
    console.log('Sparar fil som', filename);
  } catch(e){ console.error('Kunde inte spara fil:', e); }
};

console.log('F√∂r att spara filen: k√∂r saveQuizToFile() i webbl√§sarens konsol.');
</script>
</body>
</html>
